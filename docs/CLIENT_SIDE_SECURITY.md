# Client-Side Security Implementation

## 개요

이 문서는 PsyRehab 애플리케이션의 클라이언트 측 보안 구현에 대해 설명합니다. 클라이언트 측 보안은 서버 측 보안(Supabase RLS)을 보완하는 첫 번째 방어선으로 작동합니다.

## localStorage 기반 속도 제한 (Rate Limiting)

### 목적

localStorage 기반 속도 제한은 **사용자 경험(UX) 개선**을 위한 클라이언트 측 보안 기능입니다:

1. **즉각적인 피드백**: 서버 요청 없이 즉시 사용자에게 제한 상태를 알림
2. **네트워크 트래픽 감소**: 불필요한 서버 요청 방지
3. **사용자 친화적 안내**: 남은 시도 횟수와 잠금 시간 표시

### 구현 세부사항

#### 위치
- 구현: `/src/utils/auth.ts`
- 서비스 통합: `/src/services/auth.ts`
- 설정: `/src/constants/auth.ts`

#### 제한 설정
```typescript
// src/constants/auth.ts
export const RATE_LIMITS = {
  SIGNIN_ATTEMPTS: 5,          // 로그인 시도 5회
  SIGNUP_ATTEMPTS: 3,          // 회원가입 시도 3회
  PASSWORD_RESET_ATTEMPTS: 3,  // 비밀번호 재설정 3회
  LOCKOUT_DURATION: 900000     // 15분 잠금
}
```

#### 작동 방식

1. **시도 기록**: 각 인증 시도는 localStorage에 타임스탬프와 함께 기록
2. **잠금 확인**: 최대 시도 횟수 초과 시 15분간 추가 시도 차단
3. **키 형식**: `rate_limit_[action]_[identifier]` (예: `rate_limit_signin_user@example.com`)
4. **자동 정리**: 성공적인 인증 시 해당 사용자의 속도 제한 데이터 제거

### 보안 고려사항

⚠️ **중요**: localStorage 기반 속도 제한은 다음과 같은 한계가 있습니다:

1. **우회 가능**: 기술적 지식이 있는 사용자는 브라우저 개발자 도구로 우회 가능
2. **브라우저 의존적**: 다른 브라우저나 시크릿 모드 사용 시 제한 우회 가능
3. **클라이언트 신뢰**: 클라이언트 측 데이터에 의존하므로 조작 가능

### 권장 사항

1. **서버 측 보안 우선**: 중요한 보안 제어는 반드시 서버 측(Supabase RLS, Edge Functions)에서 구현
2. **UX 목적 명시**: 이 기능은 보안보다는 사용자 경험 개선이 주 목적임을 인지
3. **추가 보안 계층**: 
   - Supabase Auth의 내장 속도 제한 활용
   - Edge Functions를 통한 서버 측 속도 제한 구현 검토
   - IP 기반 속도 제한 추가 고려

## 기타 클라이언트 측 보안 조치

### 1. 입력 검증

모든 사용자 입력은 클라이언트에서 1차 검증됩니다:
- 이메일 형식 검증
- 비밀번호 강도 확인
- XSS 방지를 위한 입력 살균

### 2. 세션 관리

- 자동 로그아웃: 장시간 미사용 시
- 세션 토큰 안전한 저장
- 다중 탭 간 세션 동기화

### 3. 민감한 데이터 처리

- 비밀번호는 절대 localStorage에 저장하지 않음
- 토큰은 httpOnly 쿠키 사용 권장
- 민감한 정보는 메모리에만 유지

### 4. 에러 메시지

- 보안 관련 에러는 상세 정보 노출 방지
- 일반적인 메시지 사용 (예: "인증에 실패했습니다")

## 관리자 작업 보안

### 현재 구현

- 역할 기반 접근 제어 (RBAC)
- 관리자 전용 라우트 보호
- 권한 확인 후 UI 렌더링

### 개선 제안

1. **2단계 인증 (2FA)**
   - 관리자 계정에 대한 추가 인증 단계
   - TOTP 또는 SMS 기반 구현

2. **작업 확인**
   - 중요한 작업 시 비밀번호 재확인
   - 작업 로그 및 감사 추적

3. **세션 제한**
   - 관리자 세션 짧은 만료 시간
   - IP 기반 세션 검증

## 모니터링 및 로깅

### 현재 상태

- 클라이언트 측 에러는 `console.error`로 기록
- 보안 이벤트 추적 제한적

### 개선 방향

1. **에러 추적 서비스**
   ```typescript
   // Sentry 통합 예시
   Sentry.init({
     dsn: process.env.VITE_SENTRY_DSN,
     environment: process.env.NODE_ENV,
     beforeSend(event) {
       // 민감한 정보 필터링
       return filterSensitiveData(event);
     }
   });
   ```

2. **보안 이벤트 로깅**
   - 로그인 시도/성공/실패
   - 권한 거부 이벤트
   - 의심스러운 활동 패턴

3. **사용자 알림**
   - 이상 로그인 감지 시 이메일 알림
   - 계정 잠금 시 복구 방법 안내

## 구현 체크리스트

- [x] localStorage 기반 속도 제한 구현
- [x] 기본 입력 검증
- [x] 역할 기반 접근 제어
- [ ] 2단계 인증 (2FA)
- [ ] 서버 측 속도 제한
- [ ] 에러 추적 서비스 통합
- [ ] 보안 이벤트 로깅 시스템
- [ ] IP 기반 보안 강화

## 참고 사항

- 모든 클라이언트 측 보안은 서버 측 검증으로 보완되어야 합니다
- 보안과 사용성 간의 균형을 유지하는 것이 중요합니다
- 정기적인 보안 감사를 통해 새로운 취약점을 확인해야 합니다

## 관련 문서

- [보안 감사 절차](./SECURITY_AUDIT.md)
- [인증 구현](../src/services/auth.ts)
- [Supabase RLS 정책](../supabase/migrations/)